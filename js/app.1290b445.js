(function(e){function t(t){for(var a,s,r=t[0],l=t[1],c=t[2],u=0,f=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&f.push(i[s][0]),i[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(f.length)f.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,r=1;r<n.length;r++){var l=n[r];0!==i[l]&&(a=!1)}a&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},i={app:0},o=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/editjs/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=l;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"0aa9":function(e,t,n){"use strict";n("6e40")},"18cf":function(e,t,n){},4678:function(e,t,n){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=o,e.exports=i,i.id="4678"},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=n("f23d"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e.ready?n("Editjs",{attrs:{data:e.mock,content:e.context,events:e.events},on:{save:e.save}}):e._e()],1)},s=[],r=(n("5b81"),n("bc3a")),l=n.n(r),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-spin",{staticClass:"editjs",attrs:{spinning:e.loading,tip:"Loading..."}},[n("a-tabs",{staticStyle:{height:"100%"},attrs:{size:"small",tabBarGutter:10,tabBarExtraContent:e.createTabToolbar,tabBarStyle:{padding:"0 10px"}},model:{value:e.akey,callback:function(t){e.akey=t},expression:"akey"}},[n("div",{attrs:{slot:"toolbar"},slot:"toolbar"},[e._v("123")]),n("a-tab-pane",{key:"tab-1",attrs:{tab:"设计器"}},[n("a-layout",[n("a-layout-sider",{ref:"leftPanel",attrs:{width:260}},[n("a-collapse",{attrs:{defaultActiveKey:"2",accordion:!0,"expand-icon-position":"left",bordered:!1}},[n("a-collapse-panel",{key:"1",attrs:{header:"组件库",forceRender:""}},[n("p",{style:{height:e.height-116+"px",overflow:"auto"}},[e._v("collapse demo")]),n("a-icon",{attrs:{slot:"extra",type:"setting"},slot:"extra"})],1),n("a-collapse-panel",{key:"2",attrs:{header:"数据源"}},[n("a-tree",{style:{height:e.height-102+"px",overflow:"auto"},attrs:{blockNode:"","show-line":!0,"show-icon":!0,"default-expanded-keys":["main"]}},[n("a-tree-node",{key:"main",attrs:{selectable:!1,title:"主表"}},e._l(e.data.main.fields,(function(t,a){return n("a-tree-node",{key:"field-"+a,attrs:{disabled:t.disabled,selectable:!1,title:t.comment+"/"+t.name.toUpperCase()},nativeOn:{dblclick:function(n){return e.insertField(1,t)}}})})),1),n("a-tree-node",{key:"lines",attrs:{selectable:!1,title:"明细表"}},e._l(e.data.lines,(function(t,a){return n("a-tree-node",{key:"lines-"+a,attrs:{disabled:t.disabled,selectable:!1,title:t.table_comment+"/"+t.table_name.toUpperCase()},nativeOn:{dblclick:function(n){return e.insertField(0,t)}}})})),1)],1),n("a-icon",{attrs:{slot:"extra",type:"setting"},slot:"extra"})],1)],1)],1),n("a-layout-content",[n("Tinymce",{ref:"tmceInstance",attrs:{lang:"zh_CN",config:e.config,"field-info":Object.assign({},e.data.main,{lines:e.data.lines}),value:e.content},on:{preview:e.preview,"init-event":function(t){e.loading=!1}}})],1)],1)],1),n("a-tab-pane",{key:"tab-2",attrs:{tab:"表单设置"}},[n("FormSetting",{attrs:{data:e.data}})],1),n("a-tab-pane",{key:"tab-3",attrs:{tab:"行为设置"}},[n("BehaviorSetting",{attrs:{events:e.events,"field-data":e.data}})],1),e._l(e.tabs,(function(t,a){return n("a-tab-pane",{key:"tab-"+(4+a)},[n("span",{attrs:{slot:"tab"},slot:"tab"},[n("span",{staticStyle:{"margin-right":"5px"}},[e._v(e._s(t))]),n("a-icon",{staticClass:"tab-close",staticStyle:{"margin-right":"0"},attrs:{type:"close"},on:{click:function(t){return e.closeTab(a)}}})],1),n("EditLine",{ref:"editLine"+(4+a),refInFor:!0,attrs:{plugins:e.plugins,data:{main:e.editLines[a]},actTab:e.akey,tabIndex:"tab-"+(4+a)},on:{"init-event":function(t){e.loading=!1}}})],1)}))],2)],1)},d=[],u=n("2909"),f=(n("99af"),n("d81d"),n("a434"),n("b0c0"),n("caad"),n("ac1f"),n("1276"),n("5319"),n("b64b"),n("2532"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("textarea",{attrs:{hidden:"",id:e.tinymceId},domProps:{textContent:e._s(e.value)}})}),p=[],m=(n("b680"),function(e){return{selector:"#"+e.tinymceId,language:e.lang,skin:"oxide-x",height:"100%",menubar:!1,toolbar_sticky:!1,plugins:"print preview importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking toc insertdatetime advlist lists imagetools textpattern noneditable help charmap quickbars emoticons",toolbar:"fieldreadonly undo redo | fullscreen  preview code | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | table | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | insertfile image media template link codesample | visualblocks ltr rtl",content_style:'\n            body { font-family:Helvetica,Arial,sans-serif; font-size:14px; padding: 5px } \n            .mce-content-body [contentEditable=false][data-mce-selected] { outline: 2px solid #b4d7ff; cursor: default }\n            .mce-visualblocks { min-width: calc(100% - 32px); width: fit-content }\n            .mce-field { display: inline-block; min-height: 20px; border: 1px solid grey; font-size: 12px; position: relative;\n                line-height: 20px; padding: 0 2px; margin: 0 1px 0 2px; -webkit-user-select:none; -moz-user-select:none;  -ms-user-select:none; user-select:none;\n                color: #666666; font-weight: bold;\n            }\n            .mce-field > i {\n                background-color: white;position: absolute; right: 0px; padding: 0 5px;\n            }\n            .mce-field[mce-nobor="true"] {\n                border: 1px dashed\n            }\n            .mce-table-line { position: relative; display: block; padding-top: 10px; border: 1px dashed #bbb; min-height: 20px; margin: 2px }\n            .mce-table-line::before { content: attr(title); position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 10; font-size: 10px; color: #666666 }\n            .line_field { position: relative }\n        ',content_css:["https://cdn.jsdelivr.net/gh/medlar01/tinymce-cdn@5.9.2.4/icons/iconfont/iconfont.css"],extended_valid_elements:"i[class],span[id|class|style|mce-nobor],td[*]",table_clone_elements:"strong em b i font h1 h2 h3 h4 h5 h6 p div",table_sizing_mode:"fixed",table_default_styles:{width:"100%"},noneditable_noneditable_class:"unedit",quickbars_insert_toolbar:!1,toolbar_mode:"sliding",force_br_newlines:!1,force_p_newlines:!1,draggable_modal:!0,forced_root_block:e.block,visualblocks_default_state:!0,resize:!1,init_instance_callback:function(t){e.$emit("init-event",t)}}}),h='\n<table class="line_field" style="width: 939.016px; background-color: white" border="1">\n<thead>\n<tr style="text-align: center;">\n<td v-show="!printMode" class="checkbox" style="width: 20px" scope="col">//</td>\n<td style="width: 220.719px;" scope="col">&nbsp;</td>\n<td style="width: 220.719px;" scope="col">&nbsp;</td>\n<td style="width: 220.719px;" scope="col">&nbsp;</td>\n<td style="width: 220.734px;" scope="col">&nbsp;</td>\n</tr>\n</thead>\n<tbody>\n<tr class="line_field_row">\n<td v-show="!printMode" class="checkbox" style="width: 20px;"><input type="checkbox"/></td>\n<td style="width: 220.719px;">&nbsp;</td>\n<td style="width: 220.719px;">&nbsp;</td>\n<td style="width: 220.719px;">&nbsp;</td>\n<td style="width: 220.734px;">&nbsp;</td>\n</tr>\n</tbody>\n<tfoot>\n<tr style="background-color: #ecf0f1;">\n<td v-show="!printMode" class="checkbox" style="width: 20px">&nbsp;</td>\n<td style="width: 220.719px;">&nbsp;</td>\n<td style="width: 220.719px;">&nbsp;</td>\n<td style="width: 220.719px;">&nbsp;</td>\n<td style="width: 220.734px;">&nbsp;</td>\n</tr>\n</tfoot>\n</table>\n',b={methods:{getEditor:function(){return this.editor},getSelection:function(){return this.editor.selection},insertElement:function(e){var t=this.getSelection();t.setNode(e)},insertContent:function(e){this.getEditor().execCommand("mceInsertContent",!1,e)},focus:function(){this.getEditor().focus()},getContent:function(){return this.getEditor().getContent()},setContent:function(e){this.getEditor().setContent(e)}}},v=function(){return window["tinyMCE"]},y={props:{block:{type:String,default:"div"},tinymceId:{type:String,default:function(){return"vue-tinymce-"+Date.now()+(1e3*Math.random()).toFixed(0)}},lang:String,config:{type:Object,default:function(){return{}}},value:{type:String,default:""},plugins:{type:Array,default:function(){return[]}}},data:function(){return{editor:null,ctx:""}},mixins:[b],created:function(){var e=this;g("https://cdn.jsdelivr.net/gh/medlar01/tinymce-cdn@5.9.2.4/tinymce.js",(function(t){if(t)throw t;v().get(e.tinymceId)&&e.destroy(),e.load()}))},methods:{load:function(){var e=this,t=Object.assign(m(this),this.config);v().init(t).then((function(t){e.editor=t[0],v().setActive(t[0])}))},reload:function(){this.distory(),this.load()},distory:function(){(v().get(this.tinymceId)||this.editor).destroy(),this.editor.settings.destroy=!0}}};function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n="#vue-tinymce-5_9_2",a=document.getElementById("#"+n);function i(){a.onload=function(){this.onerror=this.onload=null,t(null)},a.onerror=function(){this.onerror=this.onload=null,t(new Error("Failed to load "+e))}}function o(){a.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||(this.onreadystatechange=null,t(null))}}a||(a=document.createElement("script"),a.id=n,a.src=e,document.body.appendChild(a)),("onload"in a?i:o)()}var x=y,j=n("2877"),k=Object(j["a"])(x,f,p,!1,null,null,null),w=k.exports,_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-layout",[n("a-layout-sider",{ref:"leftPanel",attrs:{width:260}},[n("a-collapse",{attrs:{defaultActiveKey:"2",accordion:!0,"expand-icon-position":"left",bordered:!1}},[n("a-collapse-panel",{key:"1",attrs:{header:"组件库",forceRender:""}},[n("p",{style:{height:e.height-116+"px",overflow:"auto"}},[e._v("collapse demo")]),n("a-icon",{attrs:{slot:"extra",type:"setting"},slot:"extra"})],1),n("a-collapse-panel",{key:"2",attrs:{header:"数据源"}},[n("a-tree",{style:{height:e.height-102+"px",overflow:"auto"},attrs:{blockNode:"","show-line":!0,"show-icon":!0,"default-expanded-keys":["main"]}},[n("a-tree-node",{key:"main",attrs:{selectable:!1,title:"主表"}},e._l(e.data.main.fields,(function(t,a){return n("a-tree-node",{key:"field-"+a,attrs:{disabled:t.disabled,selectable:!1,title:t.comment+"/"+t.name.toUpperCase()},nativeOn:{dblclick:function(n){return e.insertField(t)}}})})),1)],1),n("a-icon",{attrs:{slot:"extra",type:"setting"},slot:"extra"})],1)],1)],1),n("a-layout-content",[n("Tinymce",{ref:"tmceInstance",attrs:{lang:"zh_CN",config:e.config,plugins:e.plugins,"field-info":e.data,"is-line":"",value:e.value},on:{"init-event":function(t){return e.$emit("init-event")}}})],1)],1)},O=[],C=(n("a9e3"),n("eec4")),S=n.n(C),D={components:{Tinymce:w},props:{data:{type:Object,default:function(){return{}}},plugins:{type:Array,default:function(){return[]}},actTab:[String,Number],tabIndex:[String,Number]},data:function(){return{height:0,value:"",config:{}}},watch:{actTab:function(e,t){e!=t&&e==this.tabIndex&&this.$refs.tmceInstance.reload()}},created:function(){var e=this;this.config["setup"]=function(t){for(var n=[].concat(Object(u["a"])(e.plugins),[z]),a=0;a<n.length;a++){var i=n[a];i(e,t)}}},mounted:function(){var e=this;S()().listenTo(this.$refs.leftPanel.$el,(function(t){e.height=t.offsetHeight}))},methods:{insertField:function(e){if(!e.disabled){var t=this.$refs.tmceInstance,n=t.getSelection(),a=n.getNode();if("TD"==a.nodeName){var i=a.parentElement||a.parentNode;if(i&&i.classList.contains("line_field_row")){var o=E("tinymce.dom.DOMUtils"),s=o.DOM,r={class:"unedit mce-field tl",id:e.id,style:"width: 200px"};e.noBorder&&(r["border"]="1px dashed");var l=s.create("span",r,e.comment+"/"+e.name.toUpperCase()+'<i class="iconfont iconedit"/>');t.insertElement(l),e.disabled=!0,t.focus()}else{var c=t.getEditor();c.notificationManager.open({text:"请在表格第"+$(a)+"行内插入数据键",type:"error"})}}else{var d=t.getEditor();d.notificationManager.open({text:"请在表格第"+$(a)+"行内插入数据键",type:"error"})}}},setContent:function(e){var t=this.$refs.tmceInstance;t.setContent(e)},save:function(){var e=this.$refs.tmceInstance;return{metadata:this.data.main,ctx:e.getContent()}},distory:function(){var e=this.$refs.tmceInstance;e.distory()}}};function E(e,t){return window["tinyMCE"].resolve(e,t)}function M(e,t){if(e&&e.nodeName==t)return e;while(null!=e&&e.nodeName!=t&&"BODY"!=e.nodeName)e=e.parentElement||e.parentNode;return e&&e.nodeName==t?e:null}function $(e){e=M(e,"TABLE");var t=0;if(!e)return-1;var n=e.querySelectorAll("tr");for(var a in n){var i=n[a];if(t++,i.classList&&i.classList.contains("line_field_row"))return t}return-1}function z(e,t){function n(e,t,n){for(var a=0;a<t.length;a++)for(var i=t[a],o=e.bindings[i],s=0;s<o.length;s++){var r=o[s];r.removed=n}}t.on("load",(function(){if(t.hasPlugin("table")){var n=T(t),a=["tabledeleterow","tablecutrow","tablecopyrow"];L(n.menuItems,a,(function(t,n){var a=e.$refs.tmceInstance,i=a.getSelection(),o=i.getNode();if(o=M(o,"TD"),o)if(o.hasAttribute("data-mce-selected"))n.setDisabled(!0);else{var s=o.parentElement||o.parentNode;s&&s.classList.contains("line_field_row")?n.setDisabled(!0):t(n)}else t(n)}))}})),t.on("ObjectSelected",(function(){setTimeout((function(){var e=t.selection.getNode(),a=I(e,"mce-field");n(t.getEventDispatcher(),["mousemove"],a)}))}))}function T(e){return e.ui.registry.getAll()}function L(e,t,n){t&&"string"==typeof t&&(t=[t]),t.map((function(t){if(e[t]){var a=e[t].onSetup;e[t].onSetup=function(e){n(a,e)}}}))}function I(e,t){return e&&e.classList&&e.classList.contains(t)}var N=D,A=Object(j["a"])(N,_,O,!1,null,null,null),P=A.exports,U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-layout",{staticClass:"form-setting"},[n("a-layout-sider",{attrs:{width:260}},[n("a-menu",{attrs:{mode:"inline","default-selected-keys":["main"]},on:{select:e.onSelectMenu}},[n("a-menu-item",{key:"dialog",attrs:{title:"弹窗选项设置"}},[n("a-icon",{attrs:{type:"windows"}}),e._v(" 弹窗选项设置 ")],1),n("a-menu-item",{key:"main",attrs:{title:"主表："+e.data.main.table_comment}},[n("a-icon",{attrs:{type:"desktop"}}),e._v(" 主表："+e._s(e.data.main.table_comment)+" ")],1),e._l(e.data.lines||[],(function(t,a){return n("a-menu-item",{key:"line-"+(a+1),attrs:{title:"明细表："+t.table_comment}},[n("a-icon",{attrs:{type:"tag"}}),e._v(" 明细表："+e._s(t.table_comment)+" ")],1)}))],2)],1),n("a-layout-content",[n("a-spin",{staticStyle:{height:"100%"},attrs:{spinning:e.loading,tip:"Loading..."}},[n("a-table",{attrs:{rowKey:"id",size:"middle",pagination:!1,columns:e.columns,"data-source":e.tableData}})],1)],1)],1)},q=[],B={input:"文本",textarea:"文本域",number:"数值",date:"日期",select:"下拉",dialog:"弹窗"},F={render:function(){var e=this,t=arguments[0];return this.edit?t("div",{class:"cell-wrapper"},[t("a-select",{attrs:{"default-value":this.value,size:"small"},style:"width: calc(100% - 30px)",on:{change:function(t){return e.val=t}}},[Object.keys(B).map((function(e){return t("a-select-option",{attrs:{value:e}},[B[e]])}))]),t("a-icon",{attrs:{type:"check"},class:"check-icon",on:{click:function(){e.$emit("edit",e.val),e.edit=!1}}})]):t("div",{class:"cell-wrapper"},[B[this.value],t("a-icon",{attrs:{type:"edit"},class:"edit-icon",on:{click:function(){e.edit=!0,e.val=e.value}}})])},props:{value:String},data:function(){return{val:"",edit:!1}}},V={props:["row"],render:function(){var e=this,t=arguments[0];console.log("EditCell.row",this.row);var n=null;switch(this.row.category){case"date":n=t("a-input",{attrs:{size:"small",placeholder:"请输入日期格式"},style:"width: 200px",model:{value:e.row.format,callback:function(t){e.$set(e.row,"format",t)}}});break;case"select":n=t("a-input",{attrs:{size:"small",placeholder:"请输入选项，使用【,】分割"},style:"width: 200px",model:{value:e.row.options,callback:function(t){e.$set(e.row,"options",t)}}})}return t("div",[n])}},R={props:{data:{type:Object,default:function(){return{}}}},data:function(){var e=this.$createElement;return{loading:!1,columns:[{width:260,title:"键名",dataIndex:"name",customRender:function(t){return e("span",[null===t||void 0===t?void 0:t.toUpperCase()])}},{width:280,key:"comment",title:"描述",dataIndex:"comment"},{width:150,title:"是否主键",dataIndex:"pk",customRender:function(t){return e("span",[t?"是（Y）":"否（N）"])}},{width:120,key:"category",title:"表单类别",dataIndex:"category",customRender:function(t,n){return e(F,{attrs:{value:t},on:{edit:function(e){return n.category=e}}})}},{key:"-",title:"其他",dataIndex:"-",customRender:function(t,n){return e(V,{attrs:{row:n}})}}],tableData:{}}},created:function(){this.tableData=this.data.main.fields},methods:{onSelectMenu:function(e){var t=this,n=(e.item,e.key);this.loading=!0,setTimeout((function(){if("main"==n)t.tableData=t.data.main.fields;else if("dialog"==n)alert("该功能暂未实现~");else{var e=n.split("-"),a=parseInt(e[1])-1;t.tableData=t.data.lines[a].fields}t.loading=!1}),500)}}},H=R,Y=(n("ae35"),Object(j["a"])(H,U,q,!1,null,null,null)),J=Y.exports,K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-layout",{staticClass:"behavior-setting"},[n("a-layout-sider",{attrs:{width:260}},[n("a-menu",{attrs:{mode:"inline","default-selected-keys":[0]},on:{select:e.onSelectMenu}},e._l(e.events,(function(t,a){return n("a-menu-item",{key:a,attrs:{title:t.field.comment}},[n("a-icon",{attrs:{type:"tags"}}),n("span",{staticClass:"nav-text"},[e._v(e._s(t.field.comment))])],1)})),1),n("div",{staticClass:"toolbar"},[n("a-button",{attrs:{type:"dashed",shape:"round",size:"small",icon:"edit"},on:{click:function(t){e.fieldVisible=!0}}},[e._v(" 新增行为 ")])],1)],1),n("a-layout-content",{staticStyle:{padding:"20px"}},[e._l(e.currEvent.events,(function(t,a){return n("a-card",{key:a,staticStyle:{"margin-bottom":"10px"},attrs:{title:"事件："+a,size:"small",type:"inner"}},[n("a",{attrs:{slot:"extra",href:"#"},on:{click:function(t){return e.$delete(e.currEvent.events,a)}},slot:"extra"},[n("a-icon",{attrs:{type:"close"}})],1),"default"==t.bus?n("ConstEvt",{attrs:{actions:t.action,"field-data":e.fieldData}}):"script"==t.bus?n("ScriptEvt",{attrs:{actions:t.action,"field-data":e.fieldData}}):e._e()],1)})),n("div",{staticStyle:{"text-align":"center"}},[n("a-button",{staticStyle:{width:"150px"},attrs:{type:"dashed",shape:"round",size:"small",icon:"edit"},on:{click:function(t){e.evnetVisible=!0}}},[e._v(" 添加事件 ")])],1)],2),n("FieldModal",{attrs:{"field-data":e.fieldData},on:{ok:e.addFieldEvent},model:{value:e.fieldVisible,callback:function(t){e.fieldVisible=t},expression:"fieldVisible"}}),n("AddEventDialog",{on:{ok:e.addEvent},model:{value:e.evnetVisible,callback:function(t){e.evnetVisible=t},expression:"evnetVisible"}})],1)},W=[],G=n("5530"),Q=function(){var e=this,t=this,n=t.$createElement,a=t._self._c||n;return a("div",[a("a-table",{staticStyle:{"margin-bottom":"10px"},attrs:{columns:t.columns,"data-source":t.actions,bordered:"",rowKey:"id",size:"middle",pagination:!1}}),a("a-button",{staticStyle:{float:"right"},attrs:{type:"dashed",shape:"round",size:"small",icon:"edit"},on:{click:function(e){t.visible=!0}}},[t._v(" 添加 ")]),a("FieldModal",{attrs:{"field-data":t.fieldData},on:{ok:function(t){t&&e.actions.push({id:t.id,comment:t.comment+"/"+t.name.toUpperCase(),exec:{type:"Empty",value:null}})}},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}})],1)},Z=[],X={props:{visible:Boolean,fieldData:Object},data:function(){return{vis:!1,value:null}},model:{prop:"visible",event:"change"},watch:{visible:function(e,t){e!=t&&(this.vis=e)},vis:function(e,t){e!=t&&this.$emit("change",e)}},render:function(){var e=this,t=arguments[0];return t("a-modal",{attrs:{title:"选择字段"},model:{value:e.vis,callback:function(t){e.vis=t}},on:{ok:function(){e.$emit("ok",e.value),e.vis=!1}}},[t("a-tree",{attrs:{blockNode:!0,"show-line":!0,"show-icon":!0,"default-expanded-keys":["main"]},on:{select:function(t,n){if(window.console.log("select",t,n),t.length>0){var a=t[0].split("-");"field"==a[0]?e.value=e.fieldData.main.fields[a[1]]:e.value=e.fieldData.lines[a[1]]}}}},[t("a-tree-node",{attrs:{selectable:!1,title:"主表"},key:"main"},[this.fieldData.main.fields.map((function(e,n){return t("a-tree-node",{key:"field-"+n,attrs:{title:e.comment+"/"+e.name.toUpperCase()}})}))]),t("a-tree-node",{attrs:{selectable:!1,title:"明细表"},key:"lines"},[this.fieldData.lines.map((function(e,n){return t("a-tree-node",{key:"lines-"+n,attrs:{title:e.table_comment+"/"+e.table_name.toUpperCase()}})}))])])])}},ee={components:{FieldModal:X},props:{actions:Array,fieldData:Object},data:function(){var e=this,t=this.$createElement;return{visible:!1,columns:[{key:"comment",dataIndex:"comment",title:"执行字段",width:300},{key:"exec",dataIndex:"exec",title:"执行动作",customRender:function(n,a,i){var o="";switch(a.exec.type){case"const":o=t("a-input",{attrs:{size:"small",placeholder:"请输入默认值"},style:"width: calc(100% - 110px); max-width: 200px",model:{value:a.exec.value,callback:function(t){e.$set(a.exec,"value",t)}}});break}return t("div",{style:"min-width: 100px"},[t("a-select",{attrs:{"default-value":"empty",size:"small"},style:"width: 100px; vertical-align: top",on:{change:function(e){a.exec.type=e,"const"!=e&&(a.exec.value=null)}},model:{value:a.exec.type,callback:function(t){e.$set(a.exec,"type",t)}}},[t("a-select-option",{attrs:{value:"empty"}},[" EMPTY "]),t("a-select-option",{attrs:{value:"const"}},[" CONST "])])," ",o])}},{key:"-",dataIndex:"-",title:"//",width:50,align:"center",customRender:function(n,a,i){return t("a-button",{on:{click:function(){return e.actions.splice(i,1)}},attrs:{shape:"round",type:"dashed",icon:"delete",size:"small"}})}}]}}},te=ee,ne=Object(j["a"])(te,Q,Z,!1,null,null,null),ae=ne.exports,ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-table",{staticStyle:{"margin-bottom":"10px"},attrs:{columns:e.columns,"data-source":e.actions,bordered:"",rowKey:"id",size:"middle",pagination:!1}}),n("a-button",{staticStyle:{float:"right"},attrs:{type:"dashed",shape:"round",size:"small",icon:"edit"},on:{click:function(t){e.actions.push({id:e.unique(),exec:{type:"request",method:"get"}})}}},[e._v(" 添加 ")])],1)},oe=[],se=function(){var e=this,t=this,n=t.$createElement,a=t._self._c||n;return a("codemirror",{staticClass:"vue-codemirror",attrs:{options:t.options},on:{ready:function(t){return e.$emit("ready",t)},cursorActivity:function(t){return e.$emit("cursorActivity",t)},focus:function(t){return e.$emit("focus",t)},blur:function(t){return e.$emit("blur",t)}},model:{value:t.innerCode,callback:function(e){t.innerCode=e},expression:"innerCode"}})},re=[],le=n("8f94"),ce=(n("a7be"),n("7a7a"),n("693d"),n("31c5"),n("9948"),n("b933"),n("9c7b"),n("715d"),n("23de"),n("4ba6"),n("8c33"),n("7289"),n("2aed"),n("d72f"),n("0b6c"),n("9a48"),n("697e"),n("aedd"),n("164b"),n("4895"),n("cbc8"),n("8d70"),n("9f09"),n("a2c1"),{components:{codemirror:le["codemirror"]},model:{prop:"code",event:"change"},props:{code:String,options:{type:Object,default:function(){return{tabSize:4,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,keyMap:"sublime",mode:"text/javascript",theme:"monokai",extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}}}}},data:function(){return{innerCode:""}},watch:{code:{handler:function(e,t){this.innerCode=e},immediate:!0},innerCode:function(e,t){this.$emit("change",e)}}}),de=ce,ue=(n("b7ce"),Object(j["a"])(de,se,re,!1,null,null,null)),fe=ue.exports;n("159b"),n("d3b7"),n("25f0");var pe=[-1,0];function me(){var e=Date.now(),t=pe[0]===e?pe[1]+=1:pe[1]=0;pe[0]=e;var n=e+""+t,a=0,i="";while(a<n.length)i+=parseInt(n.substr(a,4)).toString(32),a+=4;var o="abcdefghijklmnopqrstuvwxyz";return o.charAt(25*Math.random())+i}var he={};function be(e,t,n){if(!he[e])return he[e]=Date.now(),void n();var a=Date.now();a-t>=he[e]&&n()}var ve={props:{actions:Array,fieldData:Object},mixins:[{methods:{unique:me}}],data:function(){var e=this,t=this.$createElement;return{visible:!1,columns:[{key:"comment",dataIndex:"comment",title:"脚本类型",width:120,customCell:function(){return{style:"vertical-align: top"}},customRender:function(n,a,i){return t("a-select",{attrs:{"default-value":"request",size:"small"},style:"width: 100px; vertical-align: top",model:{value:a.exec.type,callback:function(t){e.$set(a.exec,"type",t)}}},[t("a-select-option",{attrs:{value:"script"}},[" SCRIPT "]),t("a-select-option",{attrs:{value:"request"}},[" REQUEST "])])}},{key:"exec",dataIndex:"exec",title:"执行动作",customRender:function(n,a,i){var o="";switch(a.exec.type){case"script":o=t(fe,{model:{value:a.exec.value,callback:function(t){e.$set(a.exec,"value",t)}}});break;case"request":o=t("span",[t("a-select",{attrs:{"default-value":"get",size:"small"},style:"width: 100px",on:{change:function(e){a.exec.method=e,"const"!=e&&(a.exec.value=null)}},model:{value:a.exec.method,callback:function(t){e.$set(a.exec,"method",t)}}},[t("a-select-option",{attrs:{value:"get"}},[" GET "]),t("a-select-option",{attrs:{value:"post"}},[" POST "])])," ",t("a-input",{attrs:{size:"small",placeholder:"请输入地址"},style:"width: calc(100% - 105px)",model:{value:a.exec.url,callback:function(t){e.$set(a.exec,"url",t)}}}),t("br"),t("br"),t(fe,{model:{value:a.exec.value,callback:function(t){e.$set(a.exec,"value",t)}}})]);break}return t("div",{style:"min-width: 100px"},[o])}},{key:"-",dataIndex:"-",title:"//",width:50,align:"center",customRender:function(n,a,i){return t("a-button",{on:{click:function(){return e.actions.splice(i,1)}},attrs:{shape:"round",type:"dashed",icon:"delete",size:"small"}})}}]}}},ye=ve,ge=Object(j["a"])(ye,ie,oe,!1,null,null,null),xe=ge.exports,je={props:{visible:Boolean},model:{event:"change",prop:"visible"},data:function(){return{innerVisible:!1,type:"change",bus:"default"}},watch:{visible:{handler:function(e,t){this.innerVisible=e},immediate:!0},innerVisible:function(e,t){this.$emit("change",e)}},render:function(){var e=this,t=arguments[0];return t("a-modal",{attrs:{title:"添加事件"},on:{ok:function(t){e.$emit("ok",{type:e.type,bus:e.bus}),e.innerVisible=!1}},model:{value:e.innerVisible,callback:function(t){e.innerVisible=t}}},[t("div",["事件类型  ",t("a-select",{attrs:{placeholder:"Basic usage"},style:"width: 200px",model:{value:e.type,callback:function(t){e.type=t}}},[t("a-select-option",{attrs:{value:"change"}},["change"]),t("a-select-option",{attrs:{value:"input"}},["input"]),t("a-select-option",{attrs:{value:"keyup"}},["keyup"]),t("a-select-option",{attrs:{value:"blur"}},["blur"])])]),t("br"),t("div",["执行类型  ",t("a-select",{attrs:{placeholder:"Basic usage"},style:"width: 200px",model:{value:e.bus,callback:function(t){e.bus=t}}},[t("a-select-option",{attrs:{value:"default"}},["基础动作"]),t("a-select-option",{attrs:{value:"script"}},["脚本逻辑"])])])])}},ke={props:{visible:Boolean,fieldData:Object},data:function(){return{vis:!1,value:null}},model:{prop:"visible",event:"change"},watch:{visible:function(e,t){e!=t&&(this.vis=e)},vis:function(e,t){e!=t&&this.$emit("change",e)}},render:function(){var e=this,t=arguments[0];return t("a-modal",{attrs:{title:"选择字段"},model:{value:e.vis,callback:function(t){e.vis=t}},on:{ok:function(){e.$emit("ok",e.value),e.vis=!1}}},[t("a-tree",{attrs:{blockNode:!0,"show-line":!0,"show-icon":!0,"default-expanded-keys":["main"]},on:{select:function(t,n){if(window.console.log("select",t,n),t.length>0){var a=t[0].split("-");"field"==a[0]?e.value=e.fieldData.main.fields[a[1]]:e.value=e.fieldData.lines[a[1]]}}}},[t("a-tree-node",{attrs:{selectable:!1,title:"主表"},key:"main"},[this.fieldData.main.fields.map((function(e,n){return t("a-tree-node",{key:"field-"+n,attrs:{title:e.comment+"/"+e.name.toUpperCase()}})}))]),t("a-tree-node",{attrs:{selectable:!1,title:"明细表"},key:"lines"},[this.fieldData.lines.map((function(e,n){return t("a-tree-node",{key:"lines-"+n,attrs:{title:e.table_comment+"/"+e.table_name.toUpperCase()}})}))])])])}},we={components:{ConstEvt:ae,ScriptEvt:xe,FieldModal:ke,AddEventDialog:je},props:{events:{type:Array,default:function(){return[]}},fieldData:Object},data:function(){return{currEvent:{},fieldVisible:!1,evnetVisible:!1}},created:function(){this.currEvent=this.events[0]},methods:{onSelectMenu:function(e){e.item;var t=e.key;this.currEvent=this.events[t]},addFieldEvent:function(e){null!=e&&(console.log(e),this.events.push({field:{id:e.id,comment:e.comment+"/"+e.name.toUpperCase()},events:{}}))},addEvent:function(e){var t="On".concat(_e(e.type),"_").concat(me());this.$set(this.currEvent.events,t,Object(G["a"])(Object(G["a"])({},e),{},{action:[]}))}}};function _e(e){return e?0==e.length?e:e.substr(0,1).toUpperCase()+e.substr(1,e.length):e}var Oe=we,Ce=(n("0aa9"),Object(j["a"])(Oe,K,W,!1,null,null,null)),Se=Ce.exports,De=Se,Ee=n("325b"),Me=n.n(Ee),$e=n("9a5d"),ze=n.n($e),Te=n("6103"),Le=n.n(Te),Ie=(n("7db0"),function(e,t){e.ctx&&t.setContent(e.ctx),t.tinymce=window.tinyMCE,t.resolve=function(e,n){return t.tinymce.util.Tools.resolve(e,n)},t.getEventDispatcher=function(){return this._eventDispatcher},t.on("NodeChange Change KeyUp KeyDown SetContent",(function(){e.ctx=t.getContent(),Be(e,(function(e){return t.dom.$(e,t.getBody())}))})),t.on("undo",(function(){e.ctx=t.getContent(),Be(e,(function(e){return t.dom.$(e,t.getBody())}))}));var n=setInterval((function(){t.settings.destroy?clearInterval(n):Be(e,(function(e){var n;return null===(n=t.dom)||void 0===n?void 0:n.$(e,t.getBody())}))}),1e3);function a(e,t,n){for(var a=0;a<t.length;a++)for(var i=t[a],o=e.bindings[i],s=0;s<o.length;s++){var r=o[s];r.removed=n}}t.on("Cut Copy",(function(e){var n=t.selection,a=n.getContent();if(/[^a-zA-Z]+mce-field[^a-zA-Z]+/.test(a))return e.preventDefault(),void t.notificationManager.open({text:"【数据源/组件库】不可剪切、复制!",type:"error"})})),t.on("ObjectSelected",(function(){setTimeout((function(){var e=t.selection.getNode(),n=Ve(e,"mce-table-line");a(t.getEventDispatcher(),["mousemove"],n)}))})),t.on("dblclick",(function(t){if(Ve(t.target,"mce-table-line")){var n,a=null===(n=e.data.lines)||void 0===n?void 0:n.find((function(e){return e.id==t.target.id}));a&&e.editLineTable&&e.editLineTable(t,a)}})),t.on("BeforeExecCommand",(function(e){e.target.settings.now_event_wait=e.command})),t.on("GetContent",(function(e){"mcePreview"==e.target.settings.now_event_wait&&be("preview",300,(function(){var t=e.target.fire("preview",e),n=t.content;e.content=n}))})),t.on("load",(function(){var e=t.windowManager.open;if(t.windowManager.open=function(n,a){var i=t.fire("Winopen",{command:"winopen",args:n,params:a});return console.log("winopn",i),e(i.args,i.params)},t.hasPlugin("table")){var n=function(e){for(var t=e.querySelectorAll(".mce-table-line"),n=0;n<t.length;n++)if(t[n].hasAttribute("data-mce-selected"))return!1;return!0};Fe(t,"table",(function(e){return function(t){return e(t)&&n(t)}}))}})),t.ui.registry.addToggleButton("fieldattr",{icon:"preferences",tooltip:"编辑字段属性",onAction:Ae(e,t)}),t.ui.registry.addToggleButton("fieldhidden",{icon:"preview",tooltip:"设置字段不可见",onSetup:function(e){var n,a=t.selection.getNode();e.setDisabled(!(Pe(a)&&(null===(n=a.children[0].classList)||void 0===n||!n.contains("iconhidden-l")))),a.hapi=e},onAction:function(n){var a=t.selection.getNode();Ue(a.children[0]),qe(a.children[0],["iconfont","iconhidden-l"]),n.setDisabled(!0);var i=e.data.main.fields.find((function(e){return e.id==a.id}));i.hidden=!0,i.editable=!0,a.rapi.setDisabled(!1)}}),t.ui.registry.addToggleButton("fieldreadonly",{icon:"permanent-pen",tooltip:"设置字段不可编辑",onSetup:function(e){var n,a=t.selection.getNode();e.setDisabled(!(Pe(a)&&(null===(n=a.children[0].classList)||void 0===n||!n.contains("iconread-only")))),a.rapi=e},onAction:function(n){var a=t.selection.getNode();Ue(a.children[0]),qe(a.children[0],["iconfont","iconread-only"]),n.setDisabled(!0);var i=e.data.main.fields.find((function(e){return e.id==a.id}));i.hidden=!1,i.editable=!1,a.hapi.setDisabled(!1)}}),t.ui.registry.addContextToolbar("field",{predicate:function(e){return Pe(e)},items:"fieldattr|fieldhidden|fieldreadonly",position:"node",scope:"node",type:"contexttoolbar"})}),Ne=null;function Ae(e,t){var n={title:"编辑字段属性",size:"normal",body:{type:"panel",items:[{type:"grid",columns:2,items:[{type:"input",name:"category",label:"类别",disabled:!0}]},{type:"grid",columns:2,items:[{type:"input",name:"width",label:"width"}]},{type:"grid",columns:3,items:[{type:"label",label:"无边框",items:[{type:"checkbox",name:"nobor",label:"消除框边线"}]},{type:"label",label:"隐藏",items:[{type:"checkbox",name:"hidden",label:"字段不可见"}]},{type:"label",label:"只读",items:[{type:"checkbox",name:"readonly",label:"字段不可编辑"}]}]}]},buttons:[{type:"cancel",name:"cancel",text:"cancel"},{type:"submit",name:"save",text:"save",primary:!0}],onSubmit:function(e){var t=e.getData();Ne.style.width=t.width,Ne.setAttribute("data-mce-style","width: "+t.width),Ue(Ne.children[0]),t.hidden?qe(Ne.children[0],["iconfont","iconhidden-l"]):t.readonly?qe(Ne.children[0],["iconfont","iconread-only"]):qe(Ne.children[0],["iconfont","iconedit"]),Ne.setAttribute("mce-nobor",t.nobor),e.close()}};return function(a){var i=t.selection.getNode();if(Pe(i)){var o=e.data.main.fields.find((function(e){return e.id==i.id})),s=i.style;n["title"]="字段：".concat(i.innerText),n["initialData"]={width:s.width,category:o.category,hidden:i.children[0].classList.contains("iconhidden-l"),readonly:i.children[0].classList.contains("iconread-only"),nobor:"true"==i.getAttribute("mce-nobor")||!1},Ne=i,t.windowManager.open(n)}}}function Pe(e){var t;return e&&"SPAN"==e.nodeName&&(null===(t=e.classList)||void 0===t?void 0:t.contains("mce-field"))}function Ue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*";"string"==typeof t&&("*"===t?(t=[],e.classList.forEach((function(e){return t.push(e)}))):t=[t]);for(var n=t.length-1;n>=0;n--){var a;null===(a=e.classList)||void 0===a||a.remove(t[n])}}function qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.forEach((function(t){var n;return null===(n=e.classList)||void 0===n?void 0:n.add(t)}))}function Be(e,t){for(var n=0,a=[].concat(Object(u["a"])(e.data.main.fields),Object(u["a"])(e.data.lines||[]));n<a.length;n++){var i,o=a[n],s=!(o.id&&0==(null===(i=t("#"+o.id))||void 0===i?void 0:i.length));o.disabled=s}}function Fe(e,t,n){var a=e.ui.registry.getAll(),i=a.contextToolbars,o=i[t];o.predicate=n(o.predicate)}function Ve(e,t){return e&&e.classList&&e.classList.contains(t)}n("a15b");var Re=[function(e,t,n){var a;t.target.StyleUtils=new t.target.editorManager.resolve("tinymce.html.Styles")({}),n["data"]={},n["props"]={printMode:{type:"Boolean",default:!1}},n["body"]=t.target.dom.create("body",{},t.content);var i=t.target.resolve("tinymce.dom.DOMUtils"),o=i.DOM.$(".mce-field",n["body"]);n["data"].formData||(n["data"].formData={});var s={};[].concat(Object(u["a"])(e.data.main.fields),Object(u["a"])((a=[]).concat.apply(a,Object(u["a"])(e.data.lines.map((function(e){return e.fields}))).concat(Object(u["a"])(e.data.lines.map((function(e){return{id:e.id,comment:e.table_comment,name:e.table_name}}))))))).forEach((function(e){return s[e.id]=e})),n["cacheFields"]=s,o.each((function(e,a){var i=t.target.StyleUtils.parse(a.getAttribute("style")),o=s[a.id],r={printMode:"printMode",hidden:a.children[0].classList.contains("iconhidden-l"),readonly:a.children[0].classList.contains("iconread-only"),nobor:"true"==a.getAttribute("mce-nobor")||!1,width:i.width};"select"==o.category&&(r["options"]=o.options),"date"==o.category&&(r["format"]=o.format);var l=JSON.stringify(r,null,4).replace(/"printMode": "([^"]+)"/g,"printMode: $1");if(a.classList.contains("tl")){var c=t.target.dom.create("f-"+o.category,{":id":"'".concat(a.id,"_' + idx"),"v-model":"item.".concat(o.name),":options":l});(a.parentElement||a.parentNode).replaceChild(c,a)}else{var d=t.target.dom.create("f-"+o.category,{id:a.id,"v-model":"formData.".concat(o.name),":options":l});(a.parentElement||a.parentNode).replaceChild(d,a),n["data"].formData[o.name]=null}}))},function(e,t,n){var a=t.target.resolve("tinymce.dom.DOMUtils"),i=a.DOM.$(".mce-table-line",n["body"]),o=n["cacheFields"];i.each((function(e,a){var i=o[a.id],s=a.querySelector("table");s.id=a.id;var r=s.querySelector("tr.line_field_row");r.setAttribute("v-for","(item, idx) in formData.".concat(i.name)),r.setAttribute(":key","idx"),n["data"].formData[i.name]=[];var l=t.target.dom.create("div",{},a.innerHTML),c=t.target.dom.create("span",{"v-show":"!printMode",style:"position: absolute; right: 2px; background-color: #e7e7e785"}),d=t.target.dom.create("a-icon",{type:"plus",style:"margin: 0 5px; color: green; cursor: pointer","v-on:click":"formData.".concat(i.name,".push({})")}),u=t.target.dom.create("a-icon",{type:"minus",style:"margin: 0 5px; color: red; cursor: pointer","v-on:click":"(e) => {\n                const data = this.formData.".concat(i.name,";\n                for(let i = data.length - 1; i >= 0; i--) {\n                    if (data[i].checked) {\n                        data.splice(i, 1);\n                    }\n                }\n            }")});l.querySelectorAll('table tr > td.checkbox > input[type="checkbox"]').forEach((function(e,t){e.setAttribute("v-model","item.checked")})),c.appendChild(u),c.appendChild(d),l.querySelector("table tr > td:last-child").appendChild(c),(a.parentElement||a.parentNode).replaceChild(l,a)}))},function(e,t,n){var a=e.events,i=n["methods"]={};a.forEach((function(e){var t={};He(e.events,(function(e,a){var o=Ye(n,e);o&&((t[e.type]=t[e.type]||[]).push(a+"()"),i[a]="() { ".concat(o," }"))}));var a=n["body"].querySelector("#"+e.field.id);a&&He(t,(function(e,t){a.setAttribute("v-on:".concat(t),"() => { ".concat(e.join(";")," }"))}))}))}];function He(e,t){Object.keys(e).forEach((function(n){return t(e[n],n)}))}function Ye(e,t){var n=e["cacheFields"],a=e["data"].formData;switch(t.bus){case"default":return t.action.map((function(e){return Object.keys(a).includes(n[e.id].name)?"this.formData.".concat(n[e.id].name," = '").concat(null==e.exec.value?"":e.exec.value,"'"):null})).join(";");case"script":return t.action.map((function(e){switch(e.exec.type){case"script":return e.exec.value;case"request":return"this.axios.".concat(e.exec.method,"('").concat(e.exec.url||"get","')\n                            .then((res) => { ").concat(e.exec.value," })\n                        ");default:return null}})).join(";");default:return null}}var Je=function(){return{props:["value","options"],model:{prop:"value",event:"change"},data:function(){return{mdata:null}},watch:{value:{immediate:!0,handler:function(e){this.mdata=e}},mdata:function(e,t){e!=t&&this.$emit("change",e)},"options.printMode":{immediate:!0,handler:function(e){var t=this;!e&&this.options.nobor&&this.$nextTick((function(){var e=t.$el.children[0];e&&(e.style.border="0px",e.style["box-shadow"]="unset")}))}}}}},Ke=function(e){return{width:e.width,margin:"0 2px"}};function We(){return{mixins:[Je()],render:function(){var e=this,t=arguments[0],n=Ke(this.options);return this.options.printMode||this.options.readonly?t("div",{style:Object(G["a"])(Object(G["a"])({},n),{},{display:"inline-block"})},[this.mdata]):t("a-input",{attrs:{allowClear:!0,size:"small"},on:{blur:tt(this,this.$listeners.blur)},style:n,model:{value:e.mdata,callback:function(t){e.mdata=t}}})}}}function Ge(){return{mixins:[Je()],render:function(){var e,t=this,n=arguments[0],a=Ke(this.options);return a["vertical-align"]="top",this.options.printMode||this.options.readonly?n("div",{style:Object(G["a"])(Object(G["a"])({},a),{},{display:"inline-block"})},[null===(e=this.mdata)||void 0===e?void 0:e.split(/[\s\n]/).map((function(e){return n("div",[e])}))]):n("a-textarea",{attrs:{allowClear:!0,size:"small"},on:{blur:tt(this,this.$listeners.blur)},style:a,model:{value:t.mdata,callback:function(e){t.mdata=e}}})}}}function Qe(){return{mixins:[Je()],render:function(){var e,t=this,n=arguments[0],a=Ke(this.options),i=(null===(e=this.options.options)||void 0===e?void 0:e.split(","))||[];return this.options.printMode||this.options.readonly?n("div",{style:Object(G["a"])(Object(G["a"])({},a),{},{display:"inline-block"})},[i[this.mdata]]):n("a-select",{attrs:{allowClear:!0,size:"small"},on:{blur:tt(this,this.$listeners.blur)},style:a,model:{value:t.mdata,callback:function(e){t.mdata=e}}},[i.map((function(e,t){return n("a-select-option",{attrs:{value:t}},[e])}))])}}}function Ze(){return{mixins:[Je()],render:function(){var e,t=this,n=arguments[0],a=Ke(this.options);return this.options.printMode||this.options.readonly?n("div",{style:Object(G["a"])(Object(G["a"])({},a),{},{display:"inline-block"})},[null===(e=this.mdata)||void 0===e?void 0:e.format(this.options.format||"YYYY-MM-DD")]):n("a-date-picker",{on:{blur:tt(this,this.$listeners.blur)},style:a,attrs:{size:"small",allowClear:!0,format:this.options.format||"YYYY-MM-DD"},model:{value:t.mdata,callback:function(e){t.mdata=e}}})}}}function Xe(){return{mixins:[Je()],render:function(){var e=arguments[0],t=Ke(this.options);return this.options.printMode||this.options.readonly?e("div",{style:Object(G["a"])(Object(G["a"])({},t),{},{display:"inline-block"})},[this.mdata]):e("a-input-search",{attrs:{readOnly:!0,size:"small",allowClear:!0},on:{blur:tt(this,this.$listeners.blur),search:function(){alert("还没有实现哦~")}},style:t})}}}var et=function(){};function tt(e,t){var n=null;return function(a){n!=e.mdata&&(n=e.mdata,(t||et)(a))}}var nt={components:{Tinymce:w,EditLine:P,FormSetting:J,BehaviorSetting:De},props:{data:{type:Object,default:function(){return{}}},content:{type:String,default:""},events:{type:Array,default:function(){return[]}},plugins:{type:Array,default:function(){return[]}},conversions:{type:Array,default:function(){return[]}}},data:function(){return{akey:"tab-1",height:0,tabs:[],editLines:[],loading:!0,config:{},insidePlugins:[]}},watch:{akey:function(e,t){e!=t&&"tab-1"==e&&this.$refs.tmceInstance.reload()}},created:function(){var e=this,t=this;this.plugins.push(Ie),this.insidePlugins=this.insidePlugins.concat([].concat(Object(u["a"])(this.plugins),[function(e,n){return n.on("preview",(function(e){return t.preview(e)}))},at])),Re.map((function(t){return e.conversions.push(t)})),this.config["setup"]=function(e){for(var n=t.insidePlugins,a=0;a<n.length;a++){var i=n[a];i(t,e)}};var n=this.data.main.fields;function a(e){e.id||t.$set(e,"id",me()),t.$set(e,"disabled",!1)}for(var i=0;i<n.length;i++)a(n[i]);for(var o=this.data.lines,s=0;s<o.length;s++){a(o[s]);for(var r=0;r<o[s].fields.length;r++)a(o[s].fields[r])}},mounted:function(){var e=this;S()().listenTo(this.$refs.leftPanel.$el,(function(t){e.height=t.offsetHeight}))},methods:{closeTab:function(e){var t=this;this.tabs.splice(e,1),setTimeout((function(){t.akey="tab-1"}))},insertField:function(e,t){if(!t.disabled){var n=this.$refs.tmceInstance;if(e){var a=ot("tinymce.dom.DOMUtils"),i=a.DOM,o={class:"unedit mce-field",id:t.id,style:"width: 200px;"+(t.noBorder?"border: 1px dashed":"")},s=i.create("span",o,t.comment+"/"+t.name.toUpperCase()+'<i class="iconfont iconedit"/>');n.insertElement(s),t.disabled=!0,n.focus()}else this.openTab(t)}},insertLineTable:function(e,t){var n=this.$refs.tmceInstance,a=ot("tinymce.dom.DOMUtils"),i=a.DOM,o=i.$("#"+e.id,st().getDoc());if(o.length>0)return o=o[0],o.innerHTML=t,void(this.ctx=n.getContent());var s=i.create("div",{class:"unedit mce-table-line",title:e.table_comment,id:e.id});s.innerHTML=t||"",n.insertElement(s),e.disabled=!0,n.focus(),this.ctx=n.getContent()},editLineTable:function(e,t){this.openTab(t,e.target.innerHTML)},createTabToolbar:function(){var e=this.$createElement;if(!["tab-2","tab-3"].includes(this.akey))return e("a-button",{attrs:{type:"dashed",size:"small",shape:"round"},on:{click:this.tabSave}},[e("a-icon",{attrs:{type:"save",theme:"filled"}}),"保存"])},tabSave:function(){var e=this,t=this.akey;switch(t){case"tab-1":this.$emit("save",{tableInfo:this.data,behavior:{content:this.$refs.tmceInstance.getContent(),events:JSON.stringify(this.events),dialogs:null}});break;case"tab-2":case"tab-3":break;default:var n=t.split("-"),a=this.$refs["editLine"+n[1]];if(a&&a.length>0){this.loading=!0;var i=a[0].save();a[0].distory(),this.akey="tab-1";var o=this.tabs.indexOf(i.metadata.table_comment);o>-1&&(this.tabs.splice(o,1),this.editLines.splice(o,1)),it(this,(function(){e.insertLineTable(i.metadata,i.ctx)}))}}},openTab:function(e,t){this.loading=!0,t||this.insertLineTable(e);var n=this.tabs.indexOf(e.table_comment);n<0&&(this.tabs.push(e.table_comment),n=this.tabs.length-1),this.editLines[n]=e;var a=this;this.akey="tab-"+(4+n),it(this,(function(){var e=a.$refs["editLine"+(4+n)][0];e.setContent(t||h)}))},preview:function(e){var t=this,n={},a=this.conversions,i=e.target.resolve("tinymce.dom.DOMUtils");a.map((function(a){return a(t,e,n)}));var o=i.DOM.create("div",{style:"background-color: #5857570d; position: fixed; top: 487px; right: 0; border-radius: 8px"}),s=i.DOM.create("a-button",{"v-on:click":"printMode = false","v-show":"printMode",type:"link"},"编辑模式"),r=i.DOM.create("a-button",{"v-on:click":"printMode = true","v-show":"!printMode",type:"link"},"打印模式"),c=i.DOM.create("a-button",{"v-on:click":"() => {\n                window.alert(JSON.stringify(this.formData));\n            }",type:"link"},"获取数据"),d=i.DOM.create("a-button",{"v-on:click":"window.print()","v-show":"printMode",type:"link"},"页面打印");o.appendChild(s),o.appendChild(r),o.appendChild(c),o.appendChild(d),n["body"].appendChild(o);var u=n["body"].innerHTML;n["body"].innerHTML="";var f=i.DOM.create("div",{id:"app"});n["body"].appendChild(f);var p=i.DOM.create("script",{src:"https://cdn.jsdelivr.net/npm/vue@2"}),m=i.DOM.create("link",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.css"}),h=i.DOM.create("script",{src:"https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.js"}),b=i.DOM.create("script",{src:"https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.js"});n["body"].appendChild(p),n["body"].appendChild(b),n["body"].appendChild(m),n["body"].appendChild(h),n["data"].moment="moment";var v,y=n["methods"];rt(n["props"],"printMode")&&(n["data"].printMode=(null===(v=n["props"].printMode)||void 0===v?void 0:v.default)||!1,delete n["props"].printMode);var g=i.DOM.create("script",{type:"text/javascript"},"\n                (function() {\n                    const win = window.parent;\n                    const doc = win.document;\n                    const page = doc.querySelector('div[role=\"dialog\"] .tox-dialog__body-content');\n                    page.style.height = '557px';\n                    setInterval(() => {\n                        page.style.height = '557px';\n                    }, 500);\n                    const p = win.__PREVIEW__;\n                    const components = {};\n                    Object.keys(p.components).map(i => components[i] = p.components[i]());\n                    Vue.prototype.axios = p.axios;\n                    p.$app  = new Vue({\n                        el: '#app',\n                        props: ".concat(JSON.stringify(n["props"],null,4).replace(/"type": "([^"]+)"/g,"type: $1"),",\n                        data: ").concat(JSON.stringify(n["data"],null,4).replace(/"moment": "([^"]+)"/g,"moment: $1"),",\n                        template: `<div>").concat(u,"</div>`,\n                        components: components,\n                        methods: {\n                            ").concat(Object.keys(y).map((function(e){return e+y[e]+" "})),"\n                        }\n                    });\n                })();\n            "));n["body"].appendChild(g),e.content=n["body"].innerHTML,window["__PREVIEW__"]={axios:l.a,components:{"f-input":We,"f-textarea":Ge,"f-date":Ze,"f-select":Qe,"f-dialog":Xe}}}}};function at(e,t){t.on("winopen",(function(n){if("Preview"==n.args.title){n.content=t.getBody().innerHTML;var a=n.args.body.items;a[0].sandboxed=!1;var i=[{items:a,name:"page",title:"页面"},{items:[{name:"code",sandboxed:!1,type:"iframe"}],name:"code",title:"代码"}];n.args.body={tabs:i,type:"tabpanel"};var o={},s=e.conversions;s.map((function(t){return t(e,n,o)}));var r=o["body"].innerHTML,l=o["methods"],c=Me.a.format("<template>".concat(r,"</template><script>export default {\n                    props: ").concat(JSON.stringify(o["props"],null,4).replace(/"type": "([^"]+)"/g,"type: $1"),",\n                    data() { return ").concat(JSON.stringify(o["data"],null,4).replace(/"moment": "([^"]+)"/g,"moment: $1")," }, \n                    methods: { ").concat(Object.keys(l).map((function(e){return e+l[e]+" "}))," }\n                }","</","script>"),{parser:"vue",plugins:[ze.a,Le.a],arrowParens:"always",bracketSameLine:!1,bracketSpacing:!0,embeddedLanguageFormatting:"auto",htmlWhitespaceSensitivity:"css",insertPragma:!1,jsxSingleQuote:!1,printWidth:80,proseWrap:"preserve",quoteProps:"as-needed",requirePragma:!1,semi:!0,singleQuote:!1,tabWidth:2,trailingComma:"es5",useTabs:!1,vueIndentScriptAndStyle:!1}).replace(/\n/g,"\\n").replace(/</g,"&lt;");n.args.initialData.code='<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/styles/atom-one-dark.min.css"><script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/highlight.min.js"><\/script><script src="https://cdn.jsdelivr.net/npm/vue@2"><\/script><style>  html,body {\n                    height: calc(100% - 21px);\n                }\n                #intro,pre,pre > code {\n                    height: 100%;\n                }\n                pre > code {\n                    white-space: pre;\n                    font-family: \'Courier New\';\n                    font-size: 13px;\n                    border: 1px solid #d7c9c9;\n                    padding: 2px;\n                    overflow: auto;\n                }</style></head><body id="tinymce" class="mce-content-body "><div id="intro"><pre><code class="language-html" v-html="text" /></pre></div><script type="text/javascript">'+"   (function() {\n                    new Vue({\n                        el: '#intro',\n                        data: {\n                            text: `".concat(c,"`\n                        },\n                        mounted() {\n                            const el = this.$el.querySelector('pre code');\n                            hljs.highlightElement(el);\n                        }\n                    });\n                })()")+"<\/script></body></html>"}}))}function it(e,t){var n=setInterval((function(){e.loading||(clearInterval(n),t())}),500)}function ot(e,t){return window["tinyMCE"].resolve(e,t)}function st(){return window["tinyMCE"].activeEditor}function rt(e,t){return Object.keys(e).includes(t)}var lt=nt,ct=(n("a3d3"),Object(j["a"])(lt,c,d,!1,null,null,null)),dt=ct.exports,ut="http://114.132.201.94:8081",ft={name:"App",components:{Editjs:dt},data:function(){return{events:[],context:"",ready:!1,mock:null}},created:function(){var e=this;l.a.get(ut+"/editjs/mata-info/b3009f91-4b97-11ec-8fd2-b42e99147792/node-b11aw23h0").then((function(t){200==t.status&&(e.mock=t.data.tableInfo,e.events=JSON.parse(t.data.behavior.events.replaceAll("\\\\n","\\n")),e.context=t.data.behavior.content,e.ready=!0)}))},methods:{save:function(e){console.log("save data",e),l.a.put(ut+"/editjs/mata-info/save/b3009f91-4b97-11ec-8fd2-b42e99147792/node-b11aw23h0",e).then((function(e){console.log("res",e)}))}}},pt=ft,mt=(n("034f"),Object(j["a"])(pt,o,s,!1,null,null,null)),ht=mt.exports;n("202f");a["a"].config.productionTip=!1,a["a"].use(i["a"]),new a["a"]({render:function(e){return e(ht)}}).$mount("#app")},"6cd1":function(e,t,n){},"6e40":function(e,t,n){},"855e":function(e,t,n){},"85ec":function(e,t,n){},a3d3:function(e,t,n){"use strict";n("855e")},ae35:function(e,t,n){"use strict";n("18cf")},b7ce:function(e,t,n){"use strict";n("6cd1")}});
//# sourceMappingURL=app.1290b445.js.map